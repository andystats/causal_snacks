knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(tmle)
library(ltmle)
data(sampleDataForLtmleMSM)
library(lmtp)
# install.packages("ltmle_1.2-0.tar.gz", repos = NULL, type = "source")
library(tidyverse)
library(tmle)
library(ltmle)
data(sampleDataForLtmleMSM)
library(lmtp)
# data with two time stage: O = (L(1), A(1), L(2), A(2), Y)
get_data  <- function(n) {
L1 = rnorm(n)
A1 = rbinom(n, 1, plogis(0.01*(L1)))
L2 = 0.5*L1 + 0.7*A1 + rnorm(n)
A2 = rbinom(n, 1, plogis(0.01*(L2+A1+L1)))
Y = rbinom(n, 1, plogis(3*L1*A1 + 3*L2*A2))
O = data.frame(L1, A1, L2, A2, Y)
return(O)
}
get_data_d <- function(n, abar = 1) {
L1 = rnorm(n)
if (abar == "DTR") {
A1 = as.numeric(L1 < 0)
} else {
A1 = abar[1]
}
L2 = 0.5*L1 + 0.7*A1 + rnorm(n)
if (abar == "DTR") {
A2 = as.numeric(L2 < 0)
} else {
A2 = abar[1]
}
Y = rbinom(n, 1, plogis(3*L1*A1 + 3*L2*A2))
O = data.frame(L1, A1, L2, A2, Y)
return(O)
}
set.seed(123)
df_big <- get_data_d(1e6, abar = 1)
mean(df_big$Y)
View(df_big)
set.seed(123)
df <- get_data(1e4)
head(df)
res.11 = ltmle(df,
Anodes = c("A1", "A2"),
Lnodes = c("L1", "L2"),
Ynodes = "Y",
abar = c(1,1),
SL.library = c("SL.glm", "SL.earth", "SL.xgboost"),
SL.cvControl = list(V=10))
summary(res.11)
View(df)
df_big <- get_data_d(1e6, abar = "DTR")
mean(df_big$Y)
